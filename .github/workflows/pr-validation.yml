name: Pull Request Validation

on:
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Shallow clones should be disabled for better analysis
    
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: maven
    
    - name: Validate Maven project
      run: mvn validate
      working-directory: ./Sample-Repo
    
    - name: Run tests with coverage
      run: mvn test jacoco:report
      working-directory: ./Sample-Repo
    
    - name: Build without tests
      run: mvn -B -DskipTests clean package
      working-directory: ./Sample-Repo
    
    - name: Run static analysis (if configured)
      run: |
        echo "Running static analysis..."
        # Add your preferred static analysis tools here
        # Example: mvn sonar:sonar (requires SonarQube configuration)
      working-directory: ./Sample-Repo
    
    - name: Comment PR with build status
      uses: actions/github-script@v7
      if: always()
      with:
        script: |
          const output = `
          #### Build Results üèóÔ∏è
          - ‚úÖ Maven validation: ${{ job.status }}
          - ‚úÖ Tests: ${{ job.status }}
          - ‚úÖ Package build: ${{ job.status }}
          
          *Workflow run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}*
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: output
          });
